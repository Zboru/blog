__NUXT_JSONP__("/aws-ec2", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H){return {data:[{article:{slug:"aws-ec2",description:"Kompilacja średnio-większego projektu na instancji t2.micro",title:"JavaScript heap out of memory - kompilacja projektu na EC2 AWS",created_at:1635161069473,toc:[{id:t,depth:n,text:u},{id:v,depth:n,text:w},{id:x,depth:n,text:y},{id:z,depth:n,text:A}],body:{type:"root",children:[{type:b,tag:"h1",props:{id:"tldr-dodaj-swap-do-instancji"},children:[{type:b,tag:i,props:{href:"#tldr-dodaj-swap-do-instancji",ariaHidden:j,tabIndex:k},children:[{type:b,tag:f,props:{className:[l,m]},children:[]}]},{type:b,tag:r,props:{},children:[{type:a,value:"TL:DR dodaj SWAP do instancji"}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Niejednemu z nas mogło zdarzyć się spróbować "},{type:b,tag:r,props:{},children:[{type:a,value:"'zbudować'"}]},{type:a,value:" projekt na instancji EC2, a dokładniej na t2.micro, czyli tej najsłabszej, darmowej. Być może wszystko przeszło pomyślnie i projekt skompilował się poprawnie, a może jednak natrafiłeś na problem związany z brakiem pamięci, a dokładniej "},{type:b,tag:e,props:{},children:[{type:a,value:"FATAL ERROR: Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory"}]},{type:a,value:s}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:h,props:{alt:"Out of memory",src:"\u002Fblog\u002Fimages\u002Farticles\u002Fec2-swap\u002Fout_of_memory.png"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Wywołanie błędu próbując skompilować projekt używając Laravel Mix"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Jednym z rozwiązań w tej sytuacji jest dodanie pamięci SWAP do naszej instancji oraz pozwolenie Node.js jej użycie. Wiadomo, są inne rozwiązania takie jak:"}]},{type:a,value:c},{type:b,tag:"ol",props:{},children:[{type:a,value:c},{type:b,tag:B,props:{},children:[{type:a,value:"Użycie mocniejszego typu instancji, z większą ilością pamięci RAM"}]},{type:a,value:c},{type:b,tag:B,props:{},children:[{type:a,value:"Kompilowanie projektu na lokalnym środowisku i przesłanie plików na serwer"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"O ile rozwiązanie nr.1 jest w porządku, tak "},{type:b,tag:"u",props:{},children:[{type:a,value:"wymaga ono wyjścia z darmowej oferty"}]},{type:a,value:". Co do rozwiązania pod punktem 2, jest ono niewskazane ze względu na dyskomfort i ogólny błąd w sztuce. W czasach, gdy obecne są rozwiązania CI\u002FCD nie możemy sobie pozwolić, aby nasz projekt nie kompilował się na serwerze docelowym."}]},{type:a,value:c},{type:b,tag:o,props:{id:t},children:[{type:b,tag:i,props:{href:"#krok-1-utw%C3%B3rz-nowy-wolumen-ebs",ariaHidden:j,tabIndex:k},children:[{type:b,tag:f,props:{className:[l,m]},children:[]}]},{type:a,value:u}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Zaloguj się do "},{type:b,tag:i,props:{href:"https:\u002F\u002Faws.amazon.com\u002F",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:a,value:"panelu AWS"}]},{type:a,value:" i przejdź do instancji EC2. Z pionowego menu po lewej stronie wybierz opcję \""},{type:b,tag:p,props:{},children:[{type:a,value:"Volumes\""}]},{type:a,value:" z kategorii "},{type:b,tag:p,props:{},children:[{type:a,value:"\"Elastic Block Store\""}]},{type:a,value:". Utwórz nowy wolumen poprzez niebieski przycisk "},{type:b,tag:p,props:{},children:[{type:a,value:"\"Create Volume\""}]},{type:a,value:". W formularzu zmieniamy wielkość wolumenu na mniejszą wartość, 8GB w zupełności wystarczy nam jako SWAP. Upewnij się że tworzony wolumen jest w tej samej strefie co istniejąca instancja EC2, w moim przypadku jest to eu-central-1b. Zapisujemy uzupełniony formularz i przechodzimy do drugiego kroku.\r\n"},{type:b,tag:h,props:{alt:"aws_2.png",src:"\u002Fblog\u002Fimages\u002Farticles\u002Fec2-swap\u002Faws_2.png"},children:[]}]},{type:a,value:c},{type:b,tag:o,props:{id:v},children:[{type:b,tag:i,props:{href:"#krok-2-przypisz-wolumen-do-instancji",ariaHidden:j,tabIndex:k},children:[{type:b,tag:f,props:{className:[l,m]},children:[]}]},{type:a,value:w}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Po zapisaniu formularza zostaniemy przekierowani na listę wolumenów. Klikając prawym przyciskiem myszy na utworzony wolumen wywołaj menu kontekstowe i wybierz "},{type:b,tag:p,props:{},children:[{type:a,value:"\"Attach Volume\""}]},{type:a,value:s}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:h,props:{alt:"aws_3.png",src:"\u002Fblog\u002Fimages\u002Farticles\u002Fec2-swap\u002Faws_3.png"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Z pola dot. instancji wybierz tę, do której chcesz przypisać wolumen."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:h,props:{alt:"aws_4.png",src:"\u002Fblog\u002Fimages\u002Farticles\u002Fec2-swap\u002Faws_4.png"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"W momencie pomyślnego przypisania, p\r\nartycja powinna być dostępna bez restartu instancji. Można to sprawdzić za pomocą komendy "},{type:b,tag:e,props:{},children:[{type:a,value:C}]},{type:a,value:" w terminalu."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:h,props:{alt:"swap_1.png",src:"\u002Fblog\u002Fimages\u002Farticles\u002Fec2-swap\u002Fswap_1.png"},children:[]}]},{type:a,value:c},{type:b,tag:o,props:{id:x},children:[{type:b,tag:i,props:{href:"#krok-3-utw%C3%B3rz-partycj%C4%99-swap",ariaHidden:j,tabIndex:k},children:[{type:b,tag:f,props:{className:[l,m]},children:[]}]},{type:a,value:y}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Utwórz swap file o wielkości wolumenu za pomocą komendy"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{},children:[{type:a,value:"sudo dd if=\u002Fdev\u002Fzero of=\u002Fdev\u002Fxvdc bs=1M count=8192"}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"W miejscu "},{type:b,tag:e,props:{},children:[{type:a,value:"\u002Fdev\u002Fxvdc"}]},{type:a,value:" wstaw nazwę partycji, którą wskazuje Twoja instancja z listy "},{type:b,tag:e,props:{},children:[{type:a,value:C}]},{type:a,value:" ."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Ustaw właściciela oraz odpowiednie uprawnienia dla partycji:"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{},children:[{type:a,value:"sudo chown root:root \u002Fdev\u002Fxvdc"}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{},children:[{type:a,value:"sudo chmod 600 \u002Fdev\u002Fxvdc"}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Stwórz i oflaguj obszar wymiany"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{},children:[{type:a,value:"sudo mkswap \u002Fdev\u002Fxvdc"}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{},children:[{type:a,value:"sudo swapon \u002Fdev\u002Fxvdc"}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Dodaj poniższą linijkę do "},{type:b,tag:e,props:{},children:[{type:a,value:"\u002Fetc\u002Ffstab"}]},{type:a,value:" komendą "},{type:b,tag:e,props:{},children:[{type:a,value:"sudo nano \u002Fetc\u002Ffstab"}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{},children:[{type:a,value:"\u002Fdev\u002Fxvdc swap swap defaults 0 0"}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Jak zapiszesz i wyjdziesz z edytora, pozostaje tylko włączenie swap'u wpisując:"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{},children:[{type:a,value:"sudo swapon -a"}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Aby sprawdzić czy poprawnie utworzyliśmy partycję SWAP wystarczy że wpiszemy ponownie lsblk i zobaczymy oznaczenie [SWAP] obok naszej partycji."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:h,props:{alt:"swap_5.png",src:"\u002Fblog\u002Fimages\u002Farticles\u002Fec2-swap\u002Fswap_2.png"},children:[]}]},{type:a,value:c},{type:b,tag:o,props:{id:z},children:[{type:b,tag:i,props:{href:"#krok-4-popraw-skrypt-buildu",ariaHidden:j,tabIndex:k},children:[{type:b,tag:f,props:{className:[l,m]},children:[]}]},{type:a,value:A}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Aby Node.js mógł użyć większej ilości pamięci trzeba mu to przekazać za pomocą opcji "},{type:b,tag:e,props:{},children:[{type:a,value:"max-old-space-size"}]},{type:a,value:". Z dokumentacji oraz z wpisów innych developerów można wywnioskować kilka sposobów zastosowania tego ustawienia. Dokumentacja wskazuje na dodanie flagi podczas uruchamiania pliku, przykładowo:"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{},children:[{type:a,value:"node --max-old-space-size=8192 index.js"}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"natomiast odpowiedzi na StackOverflow sugerują wprowadzenie do terminalu komendy"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{},children:[{type:a,value:"NODE_OPTIONS=--max-old-space-size=8192"}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"i dopiero spróbować uruchomić kompilacje projektu."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Jeśli żadna z tych dwóch komend nie zadziała, spróbuj zawrzeć ustawienie tej opcji w skrypcie kompilacji w pliku "},{type:b,tag:e,props:{},children:[{type:a,value:"package.json"}]},{type:a,value:s}]},{type:a,value:c},{type:b,tag:"div",props:{className:["nuxt-content-highlight"]},children:[{type:b,tag:"pre",props:{className:["language-json","line-numbers"]},children:[{type:b,tag:e,props:{},children:[{type:b,tag:f,props:{className:[g,D]},children:[{type:a,value:"\"scripts\""}]},{type:b,tag:f,props:{className:[g,E]},children:[{type:a,value:F}]},{type:a,value:G},{type:b,tag:f,props:{className:[g,q]},children:[{type:a,value:"{"}]},{type:a,value:"\n    ...\n    "},{type:b,tag:f,props:{className:[g,D]},children:[{type:a,value:"\"production\""}]},{type:b,tag:f,props:{className:[g,E]},children:[{type:a,value:F}]},{type:a,value:G},{type:b,tag:f,props:{className:[g,"string"]},children:[{type:a,value:"\"NODE_OPTIONS=\\\"--max-old-space-size=8192\\\" mix --production\""}]},{type:b,tag:f,props:{className:[g,q]},children:[{type:a,value:H}]},{type:a,value:c},{type:b,tag:f,props:{className:[g,q]},children:[{type:a,value:"}"}]},{type:b,tag:f,props:{className:[g,q]},children:[{type:a,value:H}]},{type:a,value:c}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Dopiero ta metoda u mnie "},{type:b,tag:r,props:{},children:[{type:a,value:"'zaskoczyła'"}]},{type:a,value:" i dzięki temu mogłem dokonać produkcyjnego build'u aplikacji bez żadnych błędów. Jak widać na obrazku poniżej."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:h,props:{alt:"compiled.png",src:"\u002Fblog\u002Fimages\u002Farticles\u002Fec2-swap\u002Fcompiled.png"},children:[]}]}]},dir:"\u002F",path:"\u002Faws-ec2",extension:".md",createdAt:"2021-10-25T16:31:13.223Z",updatedAt:"2021-10-25T16:31:13.227Z"}}],fetch:{},mutations:void 0}}("text","element","\n","p","code","span","token","img","a","true",-1,"icon","icon-link",2,"h2","strong","punctuation","em",".","krok-1-utwórz-nowy-wolumen-ebs","Krok 1. Utwórz nowy wolumen EBS","krok-2-przypisz-wolumen-do-instancji","Krok 2. Przypisz wolumen do instancji","krok-3-utwórz-partycję-swap","Krok 3. Utwórz partycję SWAP","krok-4-popraw-skrypt-buildu","Krok 4. Popraw skrypt build'u","li","lsblk","property","operator",":"," ",",")));